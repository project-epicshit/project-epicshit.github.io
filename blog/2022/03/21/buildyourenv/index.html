<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta name=viewport content="width=device-width,initial-scale=1"><title>Build your DevOps Environment!</title><meta name=author content="Fabian Born"><meta name=keywords content="Fabian Born,hugo,go"><meta name=description content><meta name=generator content="Hugo 0.85.0"><link href="//fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,500,700,800" rel=stylesheet type=text/css><link rel=stylesheet href=//use.fontawesome.com/releases/v5.11.2/css/all.css><link rel=stylesheet href=//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link href=/css/animate.css rel=stylesheet><link href=/css/style.blue.css rel=stylesheet id=theme-stylesheet><link href=/css/custom.css rel=stylesheet><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel="shortcut icon" href=/img/favicon.ico type=image/x-icon><link rel=apple-touch-icon href=/img/apple-touch-icon.png><link href=/css/owl.carousel.css rel=stylesheet><link href=/css/owl.theme.css rel=stylesheet><link rel=alternate href=https://project.epicshit.io/index.xml type=application/rss+xml title="-:: Cloud is yours and all the new things ::-"><meta property="og:locale" content="en_us"><meta property="og:site_name" content="-:: Cloud is yours and all the new things ::-"><meta property="og:title" content="Build your DevOps Environment!"><meta property="og:type" content="article"><meta property="og:url" content="https://project.epicshit.io/blog/2022/03/21/buildyourenv/"><meta property="og:description" content><meta property="og:image" content="https://project.epicshit.io/nadevops_p1.png"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content="1033"><meta property="og:image:height" content="352"><meta property="og:updated_time" content="2022-03-21T00:00:00+0200"><meta property="article:section" content="NetApp"><meta property="article:published_time" content="2022-03-21T00:00:00+0200"><meta property="article:modified_time" content="2022-03-21T00:00:00+0200"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Build your DevOps Environment!"><meta name=twitter:image content="https://project.epicshit.io/nadevops_p1.png"><meta name=twitter:description content></head><body><div id=all><header class=navbar-affixed-top data-spy=affix data-offset-top=62><div class="navbar navbar-default yamm" role=navigation id=navbar><div class=container><div class=navbar-header><a class="navbar-brand home" href=/><img src=/img/logo.png alt="Build your DevOps Environment! logo" class="hidden-xs hidden-sm">
<img src=/img/logo.png alt="Build your DevOps Environment! logo" class="visible-xs visible-sm">
<span class=sr-only>Build your DevOps Environment! - go to homepage</span></a><div class=navbar-buttons><button type=button class="navbar-toggle btn-template-main" data-toggle=collapse data-target=#navigation>
<span class=sr-only>Toggle Navigation</span>
<i class="fas fa-align-justify"></i></button></div></div><div class="navbar-collapse collapse" id=navigation><ul class="nav navbar-nav navbar-right"><li class=dropdown><a href=/>Home</a></li><li class="dropdown use-yamm yamm-fw"><a href=# class=dropdown-toggle data-toggle=dropdown role=button aria-haspopup=true aria-expanded=false>Blog <span class=caret></span></a><ul class=dropdown-menu><li><div class=yamm-content><div class=row><div class=col-sm-6><img src=/img/blogging.png class="img-responsive hidden-xs"></div><div class=col-sm-3><h5>Blog Posts</h5><ul><li><a href=/blog/>all Posts</a></li><li><a href=/categories/devops/>DevOps</a></li><li><a href=/categories/cloud/>Cloud</a></li><li><a href=/categories/netapp/>NetApp</a></li></ul></div><div class=col-sm-3></div></div></div></li></ul></li><li class="dropdown use-yamm yamm-fw"><a href=# class=dropdown-toggle data-toggle=dropdown role=button aria-haspopup=true aria-expanded=false>Community <span class=caret></span></a><ul class=dropdown-menu><li><div class=yamm-content><div class=row><div class=col-sm-6><img src=https://connectedindustry.net/wp-content/uploads/sites/18/2016/11/icon-community-300x234.png class="img-responsive hidden-xs"></div><div class=col-sm-3><h5>Enter Community</h5><ul><li><a href=https://auth.epicshit.io/if/flow/default-enrollment-flow/>Sign Up</a></li><li><a href=https://auth.epicshit.io>Login</a></li></ul></div><div class=col-sm-3></div></div></div></li></ul></li></ul></div><div class="collapse clearfix" id=search><form class=navbar-form role=search><div class=input-group><input type=text class=form-control placeholder=Search>
<span class=input-group-btn><button type=submit class="btn btn-template-main"><i class="fas fa-search"></i></button></span></div></form></div></div></div></header><div id=heading-breadcrumbs><div class=container><div class=row><div class=col-md-12><h1>Build your DevOps Environment!</h1></div></div></div></div><div id=content><div class=container><div class=row><div class=col-md-9 id=blog-post><p class="text-muted text-uppercase mb-small text-right">March 21, 2022</p><div id=post-content><h1 id=build-your-devops-environment>Build your DevOps Environment!</h1><p>The LinkedIn post <a href=https://www.linkedin.com/pulse/netapp-cloud-devops-context-fabian-born/>&ldquo;NetApp in a Cloud DevOps Context&rdquo;</a> showed how an optimized Kubernetes environment can look in the cloud. This series of articles now show how to build such an environment in an automated way.</p><p>There will be four parts to this series.</p><ul><li>Part 1: Planning</li><li>Part 2: Setting up the required infrastructure</li><li>Part 3: Activation of the backup</li><li>Part 4: Monitoring and optimization of the environment</li></ul><p>The cloud providers Microsoft Azure and Google Cloud Platform are used to set up the test environments. However, this is only because NetApp&rsquo;s Astra Control Service does not support Amazon Web Service. As soon as it is available, this will be made up for immediately.</p><p><strong>Before we start, a short note:</strong> The scripts used here can be used for testing purposes. However, I assume no liability for the use in production environments. In addition, these also <strong>generate cloud resources, which will generate costs!</strong></p><p>Deploying scripts is easy. However, you need to think about several points in advance:</p><p>Setup of the network in the cloud - IP addresses, firewall rules, etc.
Access rights to cloud resources
Licenses</p><h3 id=preparation-of-the-cloud-provider-environments>Preparation of the Cloud Provider Environments</h3><p>To set up a test environment, you need to register the NetApp resource provider in Azure. As soon as the registration is completed, a NetApp account must be created in Azure, in which the capacity pool and volumes will later be created.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>az account set --subscription &lt;subscriptionId&gt;
</code></pre></div><p>As soon as Azure NetApp Files has been released, a NetApp account is created in a resource group that can be used for the test environment. This resource group is then also used later on.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>az netappfiles account create --resource-group &lt;rg-name&gt; --location &lt;location&gt; --account-name &lt;anf-account-name&gt;
</code></pre></div><p>With Google Cloud, you select the Cloud Volume Service in the Market Place and accept the EULA. Before you can provision storage, however, you have to establish communication with the managed NetApp. This can be done conveniently via the GCP Cloud Console.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>## CVS &#34;default&#34;</span>
gcloud --project<span style=color:#f92672>=</span>&lt;gcp-project&gt; compute addresses create netapp-addresses-sds-default --global --purpose<span style=color:#f92672>=</span>VPC_PEERING --prefix-length<span style=color:#f92672>=</span><span style=color:#ae81ff>25</span> --network<span style=color:#f92672>=</span>default --no-user-output-enable
gcloud --project<span style=color:#f92672>=</span>&lt;gcp-project&gt; services vpc-peerings connect --service<span style=color:#f92672>=</span>cloudvolumesgcp-sds-api-network.netapp.com --ranges<span style=color:#f92672>=</span>netapp-addresses-sds-default --network<span style=color:#f92672>=</span>default --no-user-output-enabled
gcloud --project<span style=color:#f92672>=</span>&lt;gcp-project&gt; compute networks peerings update netapp-sds-nw-customer-peer --network<span style=color:#f92672>=</span>default --import-custom-routes --export-custom-routes


<span style=color:#75715e>## CVS Performance</span>
gcloud --project<span style=color:#f92672>=</span>&lt;gcp-project&gt; compute addresses create netapp-addresses-default --global --purpose<span style=color:#f92672>=</span>VPC_PEERING --prefix-length<span style=color:#f92672>=</span><span style=color:#ae81ff>24</span> --network<span style=color:#f92672>=</span>default --no-user-output-enabled
gcloud --project<span style=color:#f92672>=</span>&lt;gcp-project&gt; services vpc-peerings connect --service<span style=color:#f92672>=</span>cloudvolumesgcp-api-network.netapp.com --ranges<span style=color:#f92672>=</span>netapp-addresses-default --network<span style=color:#f92672>=</span>default --no-user-output-enabled

gcloud --project<span style=color:#f92672>=</span>&lt;gcp-project&gt; compute networks peerings update netapp-cv-nw-customer-peer --network<span style=color:#f92672>=</span>default --import-custom-routes --export-custom-routesd
</code></pre></div><p>Now you can start provisioning storage.</p><h3 id=deploying-the-infrastructure>Deploying the infrastructure</h3><p>Now that the basics are in place, this article looks at deploying Kubernetes platforms to cloud providers (Microsoft Azure and Google Cloud). Of course, Kubernetes clusters can be deployed manually based on virtual machines. However, in an optimized environment, the cloud provider native services should be used: i.e. Azure Kubernetes Service or Google Kubernetes Engine.</p><p>To ensure that each environment always looks the same, Terraform is used for deployment. Note: The scripts provided can be used for testing purposes. However, I, Fabian Born, do not assume any liability.</p><p>All necessary files are on GitHub and can be downloaded at any time.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>git clone https://github.com/fabian-born/build-demo-environment.git
</code></pre></div><p>The repo is structured in such a way that you have a separate folder with settings options for each cloud provider:
<img src=/buildenv-gitfolder.png alt="Folder Structure!" title="Folder Structure"></p><p>Before using the scripts, <code>terraform.tfvars</code> must be adapted to the cloud provider environment.</p><h4 id=for-azure>For Azure</h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>az_appId  <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
<span style=color:#75715e>## AppPassword</span>
az_password <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
<span style=color:#75715e>## TenantID</span>
az_tenantId <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
aks_node_number <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>
az_existingRG <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;astra-demo-rg&#34;</span>
az_anfaccount <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;astra-demo-anf&#34;</span>
az_anf_sl <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Standard&#34;</span>
az_anf_poolsize <span style=color:#f92672>=</span> <span style=color:#ae81ff>4</span>
az_anf_poolname <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
prefix <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
</code></pre></div><h4 id=and-for-gcp>and for GCP</h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>prefix <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>

gcp-project <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
gcp-sa <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>

region <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
network <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;default&#34;</span>
subnetwork <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
ip_range_pods <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
ip_range_services <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
nodepoolname <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;node-pool&#34;</span>
</code></pre></div><p>In order to start the installation, all required Terraform modules must first be downloaded (1). After that it is recommended to perform a planning run. Here you can see if it will work. Then run the script against the Cloud Provider API.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#f92672>(</span>1<span style=color:#f92672>)</span> terraform init
<span style=color:#f92672>(</span>2<span style=color:#f92672>)</span> terraform plan
<span style=color:#f92672>(</span>3<span style=color:#f92672>)</span> terraform apply
</code></pre></div><p>As a result, you end up with a ready-to-run Kubernetes platform on Azure or GCP.</p><p><a href=https://youtu.be/-UDWRjn4GUw><img src=https://img.youtube.com/vi/-UDWRjn4GUw/2.jpg alt="Deploy it on GKE"></a></p></div></div><div class=col-md-3><div class="panel panel-default sidebar-menu"><div class=panel-heading><h3 class=panel-title>Search</h3></div><div class=panel-body><form action=//google.com/search method=get accept-charset=utf-8 role=search><div class=input-group><input type=search name=q class=form-control placeholder=Search>
<input type=hidden name=sitesearch value=https://project.epicshit.io/>
<span class=input-group-btn><button type=submit class="btn btn-template-main"><i class="fas fa-search"></i></button></span></div></form></div></div><div class="panel panel-default sidebar-menu"><div class=panel-heading><h3 class=panel-title>Categories</h3></div><div class=panel-body><ul class="nav nav-pills nav-stacked"><li><a href=/categories/ansible>ANSIBLE (4)</a></li><li><a href=/categories/astra-control>ASTRA-CONTROL (2)</a></li><li><a href=/categories/astracontrol>ASTRACONTROL (6)</a></li><li><a href=/categories/automation>AUTOMATION (6)</a></li><li><a href=/categories/aws>AWS (1)</a></li><li><a href=/categories/azure>AZURE (5)</a></li><li><a href=/categories/cloud>CLOUD (3)</a></li><li><a href=/categories/devops>DEVOPS (12)</a></li><li><a href=/categories/docker>DOCKER (8)</a></li><li><a href=/categories/gcp>GCP (5)</a></li><li><a href=/categories/hashicorp>HASHICORP (1)</a></li><li><a href=/categories/homematic>HOMEMATIC (2)</a></li><li><a href=/categories/jenkins>JENKINS (2)</a></li><li><a href=/categories/kubernetes>KUBERNETES (12)</a></li><li><a href=/categories/netapp>NETAPP (12)</a></li><li><a href=/categories/openshift>OPENSHIFT (1)</a></li><li><a href=/categories/powershell>POWERSHELL (1)</a></li><li><a href=/categories/redhat>REDHAT (1)</a></li><li><a href=/categories/trident>TRIDENT (12)</a></li></ul></div></div><div class="panel sidebar-menu"><div class=panel-heading><h3 class=panel-title>Tags</h3></div><div class=panel-body><ul class=tag-cloud><li><a href=/tags/ansible><i class="fas fa-tags"></i> ansible</a></li><li><a href=/tags/automation><i class="fas fa-tags"></i> automation</a></li><li><a href=/tags/cloud><i class="fas fa-tags"></i> cloud</a></li><li><a href=/tags/hashicorp><i class="fas fa-tags"></i> hashicorp</a></li></ul></div></div></div></div></div></div><footer id=footer><div class=container><div class="col-md-4 col-sm-6"><h4>About us</h4><p>That's all my own thoughts.</p><hr class="hidden-md hidden-lg hidden-sm"></div><div class="col-md-4 col-sm-6"><h4>Recent posts</h4><div class=blog-entries><div class="item same-height-row clearfix"><div class="image same-height-always"><a href=https://project.epicshit.io/blog/2023/10/05/fsxnwithrosa/><img src=https://github.com/project-epicshit/project-epicshit.github.io/assets/36699674/6c80b9b6-c0c0-415a-9606-178ce4f9b743 class=img-responsive alt="FSxN & ROSA = ❤️"></a></div><div class="name same-height-always"><h5><a href=https://project.epicshit.io/blog/2023/10/05/fsxnwithrosa/>FSxN & ROSA = ❤️</a></h5></div></div><div class="item same-height-row clearfix"><div class="image same-height-always"><a href=https://project.epicshit.io/blog/2023/05/02/netapptridentintheedge/><img src=/trident-in-the-edge.png class=img-responsive alt="NetApp Trident in the Edge"></a></div><div class="name same-height-always"><h5><a href=https://project.epicshit.io/blog/2023/05/02/netapptridentintheedge/>NetApp Trident in the Edge</a></h5></div></div><div class="item same-height-row clearfix"><div class="image same-height-always"><a href=https://project.epicshit.io/blog/2022/04/13/buildyourenv-monitoring/><img src=/byke_title_monitoring.png class=img-responsive alt="Monitoring of Kubernetes Cluster ..."></a></div><div class="name same-height-always"><h5><a href=https://project.epicshit.io/blog/2022/04/13/buildyourenv-monitoring/>Monitoring of Kubernetes Cluster ...</a></h5></div></div></div><hr class="hidden-md hidden-lg"></div></div></footer><div id=copyright><div class=container><div class=col-md-12><p class=pull-left>Copyright (c) 2021, Fabian Born; all rights reserved.</p><p class=pull-right>Template by <a href=https://bootstrapious.com/p/universal-business-e-commerce-template>Bootstrapious</a>.
Ported to Hugo by <a href=https://github.com/devcows/hugo-universal-theme>DevCows</a>.</p></div></div></div></div><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-144284829-1','auto'),ga('send','pageview'))</script><script src=//code.jquery.com/jquery-3.1.1.min.js integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin=anonymous></script><script src=//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script><script src=//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/Counter-Up/1.0/jquery.counterup.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/jquery-parallax/1.1.3/jquery-parallax.js></script><script src=/js/front.js></script><script src=/js/owl.carousel.min.js></script></body></html>