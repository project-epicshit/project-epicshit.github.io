<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta name=viewport content="width=device-width,initial-scale=1"><title>Add Kubernetes Cluster to Astra Control</title><meta name=author content="Fabian Born"><meta name=keywords content="Fabian Born,hugo,go"><meta name=description content><meta name=generator content="Hugo 0.85.0"><link href="//fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,500,700,800" rel=stylesheet type=text/css><link rel=stylesheet href=//use.fontawesome.com/releases/v5.11.2/css/all.css><link rel=stylesheet href=//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link href=/css/animate.css rel=stylesheet><link href=/css/style.blue.css rel=stylesheet id=theme-stylesheet><link href=/css/custom.css rel=stylesheet><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel="shortcut icon" href=/img/favicon.ico type=image/x-icon><link rel=apple-touch-icon href=/img/apple-touch-icon.png><link href=/css/owl.carousel.css rel=stylesheet><link href=/css/owl.theme.css rel=stylesheet><link rel=alternate href=https://project.epicshit.io/index.xml type=application/rss+xml title="-:: Cloud is yours and all the new things ::-"><meta property="og:locale" content="en_us"><meta property="og:site_name" content="-:: Cloud is yours and all the new things ::-"><meta property="og:title" content="Add Kubernetes Cluster to Astra Control"><meta property="og:type" content="article"><meta property="og:url" content="https://project.epicshit.io/blog/2022/04/03/buildyourenv-addbackup/"><meta property="og:description" content><meta property="og:image" content="https://project.epicshit.io/nadevops-autobackup.png"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content="632"><meta property="og:image:height" content="276"><meta property="og:updated_time" content="2022-04-03T00:00:00+0200"><meta property="article:section" content="NetApp"><meta property="article:published_time" content="2022-04-03T00:00:00+0200"><meta property="article:modified_time" content="2022-04-03T00:00:00+0200"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Add Kubernetes Cluster to Astra Control"><meta name=twitter:image content="https://project.epicshit.io/nadevops-autobackup.png"><meta name=twitter:description content></head><body><div id=all><header class=navbar-affixed-top data-spy=affix data-offset-top=62><div class="navbar navbar-default yamm" role=navigation id=navbar><div class=container><div class=navbar-header><a class="navbar-brand home" href=/><img src=/img/logo.png alt="Add Kubernetes Cluster to Astra Control logo" class="hidden-xs hidden-sm">
<img src=/img/logo.png alt="Add Kubernetes Cluster to Astra Control logo" class="visible-xs visible-sm">
<span class=sr-only>Add Kubernetes Cluster to Astra Control - go to homepage</span></a><div class=navbar-buttons><button type=button class="navbar-toggle btn-template-main" data-toggle=collapse data-target=#navigation>
<span class=sr-only>Toggle Navigation</span>
<i class="fas fa-align-justify"></i></button></div></div><div class="navbar-collapse collapse" id=navigation><ul class="nav navbar-nav navbar-right"><li class=dropdown><a href=/>Home</a></li><li class="dropdown use-yamm yamm-fw"><a href=# class=dropdown-toggle data-toggle=dropdown role=button aria-haspopup=true aria-expanded=false>Blog <span class=caret></span></a><ul class=dropdown-menu><li><div class=yamm-content><div class=row><div class=col-sm-6><img src=/img/blogging.png class="img-responsive hidden-xs"></div><div class=col-sm-3><h5>Blog Posts</h5><ul><li><a href=/blog/>all Posts</a></li><li><a href=/categories/devops/>DevOps</a></li><li><a href=/categories/cloud/>Cloud</a></li><li><a href=/categories/netapp/>NetApp</a></li></ul></div><div class=col-sm-3></div></div></div></li></ul></li><li class="dropdown use-yamm yamm-fw"><a href=# class=dropdown-toggle data-toggle=dropdown role=button aria-haspopup=true aria-expanded=false>Community <span class=caret></span></a><ul class=dropdown-menu><li><div class=yamm-content><div class=row><div class=col-sm-6><img src=https://connectedindustry.net/wp-content/uploads/sites/18/2016/11/icon-community-300x234.png class="img-responsive hidden-xs"></div><div class=col-sm-3><h5>Enter Community</h5><ul><li><a href=https://auth.epicshit.io/if/flow/default-enrollment-flow/>Sign Up</a></li><li><a href=https://auth.epicshit.io>Login</a></li></ul></div><div class=col-sm-3></div></div></div></li></ul></li></ul></div><div class="collapse clearfix" id=search><form class=navbar-form role=search><div class=input-group><input type=text class=form-control placeholder=Search>
<span class=input-group-btn><button type=submit class="btn btn-template-main"><i class="fas fa-search"></i></button></span></div></form></div></div></div></header><div id=heading-breadcrumbs><div class=container><div class=row><div class=col-md-12><h1>Add Kubernetes Cluster to Astra Control</h1></div></div></div></div><div id=content><div class=container><div class=row><div class=col-md-9 id=blog-post><p class="text-muted text-uppercase mb-small text-right">April 3, 2022</p><div id=post-content><h1 id=automated-enabling-backup>Automated enabling backup</h1><p>In the first post, we wrote about the requirements for an optimized DevOps environment. In the second, we provisioned the Kubernetes cluster with NetApp storage.</p><p>As soon as applications run in the Kubernetes cluster and generate data, there is no getting around the topic of backup. Astra Control is used as the backup solution.</p><p>Astra Control is NetApp&rsquo;s solution for Application-Aware Backup of Kubernetes apps. Astra Control backs up application metadata in addition to PVCs. Thus, entire applications can be restored. For this purpose, well-known NetApp technologies such as SnapShots are used. Snapshots are stored on S3 storage. If applications require special handling before and after SnapShots are created, special execution hooks can be created.</p><p>However, before you can automatically add the Kubernetes cluster to Astra Control Center, you must first make preparations on the Astra Control Service:</p><ul><li>Generate API token</li></ul><p>This short video shows how to generate the API Key:</p><p><a href=https://youtu.be/SBiXwD3Bb9Y><img src=https://img.youtube.com/vi/SBiXwD3Bb9Y/0.jpg alt="Generate API TOKEN"></a></p><p>Now that the API key has been generated, let&rsquo;s look at the tools that can be used to add a Kubernetes cluster to Astra Control.</p><ol><li>NetApp Astra Control Python SDK</li><li>Ansible Playbook</li></ol><p>The basis for both tools is the access to the Rest API. To perform actions it is necessary to get UUIDs for individual objects. To succeed, you need to perform the following steps.</p><ol><li>Get Cloud Provider Id</li><li>Get Kubernetes Cluster Id</li><li>Get Default StorageClass Id</li><li>Enable management of Kubernetes Cluster</li></ol><h2 id=netapp-astra-control-python-sdk>NetApp Astra Control Python SDK</h2><p>NetApp provides the Astra Control Python SDK on GitHub. This can be downloaded via</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>git clone https://github.com/NetApp/netapp-astra-toolkits.git
</code></pre></div><p>To get it running, some Python programs have to be installed. Detailed installation instruction is available on the GitHub repository.</p><p>Based on the four steps above, the use of the toolkit is as follows:</p><p>List of available cloud provider:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>./toolkit.py -oyaml list clouds     
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>    <span style=color:#f92672>48cc550d-3b69-49d9-9515-0b1f8b20f35e</span>:
    - <span style=color:#ae81ff>Azure</span>
    - <span style=color:#ae81ff>Azure</span>
    <span style=color:#f92672>bc96b574-cb68-4113-9693-6438020cc27b</span>:
    - <span style=color:#ae81ff>GCP</span>
    - <span style=color:#ae81ff>GCP</span>

</code></pre></div><p>List of available clusters and search for the IDs of the previously created Kubernetes cluster:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>./toolkit.py -oyaml list clusters                                                                                                  
</code></pre></div><p>Output:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>    <span style=color:#f92672>71aab527-0912-447e-a2cd-54ece8eb3305</span>:
    - <span style=color:#ae81ff>fabianb-holy-mink</span>
    - <span style=color:#ae81ff>aks</span>
    - <span style=color:#ae81ff>unmanaged</span>
    - <span style=color:#ae81ff>48cc550d-3b69-49d9-9515-0b1f8b20f35e</span>
</code></pre></div><p>List the available storage classes:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>./toolkit.py -oyaml list storageclasses
</code></pre></div><p>Output:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>48cc550d-3b69-49d9-9515-0b1f8b20f35e</span>:
  <span style=color:#f92672>08ca2a26-b2bd-499a-a031-23522d77d40b</span>: {}
  <span style=color:#f92672>258aa38c-353c-4c94-b421-c3e7a630b70f</span>: {}
  <span style=color:#f92672>71aab527-0912-447e-a2cd-54ece8eb3305</span>:
    <span style=color:#f92672>472f6719-3fd8-400d-8423-55a4f62215a8</span>: <span style=color:#ae81ff>azurefile</span>
    <span style=color:#f92672>589c626a-1b58-4785-b445-ba777a151f7c</span>: <span style=color:#ae81ff>managed-csi-premium</span>
    <span style=color:#f92672>5e7c0e49-378c-49a7-83a9-8d2cd4856753</span>: <span style=color:#ae81ff>managed</span>
    <span style=color:#f92672>6b55adbf-74ea-4f59-8929-b82f14ea56c4</span>: <span style=color:#ae81ff>default</span>
    <span style=color:#f92672>ab215262-438f-4bfc-864e-1a8649795cde</span>: <span style=color:#ae81ff>azurefile-premium</span>
    <span style=color:#f92672>aef790c4-2050-49e9-9d0b-f31604e9d166</span>: <span style=color:#ae81ff>azurefile-csi-premium</span>
    <span style=color:#f92672>ba6d5a64-a321-4fd7-9842-9adce829229a</span>: <span style=color:#ae81ff>netapp-anf-perf-standard</span>
    <span style=color:#f92672>c78e3e2f-184c-45aa-bfd6-dcacf5b7750c</span>: <span style=color:#ae81ff>managed-csi</span>
    <span style=color:#f92672>e8e0163f-3b42-4589-9b22-aeabbf7fab03</span>: <span style=color:#ae81ff>azurefile-csi</span>
    <span style=color:#f92672>ff184761-6b2f-48df-9716-8f0c9f1b50fd</span>: <span style=color:#ae81ff>managed-premium</span>
  <span style=color:#f92672>9e67112f-e14a-4a3e-b6b2-13bb0f9816ad</span>: {}
<span style=color:#f92672>bc96b574-cb68-4113-9693-6438020cc27b</span>: {}
</code></pre></div><p>Now that all the IDs are there, set the cluster to managed:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>./toolkit.py manage cluster 71aab527-0912-447e-a2cd-54ece8eb3305 ba6d5a64-a321-4fd7-9842-9adce829229a
</code></pre></div><p><a href=https://youtu.be/8JZcwOYJEgM><img src=https://img.youtube.com/vi/8JZcwOYJEgM/0.jpg alt="Add Cluster to ACS with Toolkit"></a></p><p>Alternatively, Ansible Playbook can be used, which is available in the GitHub repository build-demo-environment.</p><h2 id=the-ansible-playbook>The Ansible playbook</h2><p>For the execution of the Ansible playbook, the following two parameters must also be adjusted in the variable file:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>clustername</span>: <span style=color:#e6db74>&#34;clustername&#34;</span>
<span style=color:#f92672>storageclassname</span>: <span style=color:#e6db74>&#34;default-storage-name&#34;</span>
<span style=color:#f92672>cloudprovidername</span>: <span style=color:#e6db74>&#34;Azure / GCP&#34;</span>
</code></pre></div><p>Now you can run the playbook:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ansible-playbook add-cluster-to-acs.yaml
</code></pre></div><p><a href=https://youtu.be/mJf5SBCN4eo><img src=https://img.youtube.com/vi/mJf5SBCN4eo/0.jpg alt="Add Cluster to ACS with Toolkit"></a></p><p>After the Kubernetes cluster has been successfully added to Astra Control, you can manage your applications. How this works has already been shown in this <a href=https://youtu.be/UcUUqcjWzFg>Video</a> (which is currently only available in German - sorry for that).</p><h3 id=resources>Resources</h3><p><a href=https://github.com/fabian-born/build-demo-environment>GitHub Repository for this Post</a></p><p><a href=https://project.epicshit.io/blog/2022/03/21/buildyourenv/>Blog Post: Build your DevOps Environment!</a></p><p><a href=https://youtu.be/UcUUqcjWzFg>Video: Backup and Restore</a></p><p><a href=https://github.com/NetApp/netapp-astra-toolkits.git>NetApp Astra Control Python Toolkit</a></p></div></div><div class=col-md-3><div class="panel panel-default sidebar-menu"><div class=panel-heading><h3 class=panel-title>Search</h3></div><div class=panel-body><form action=//google.com/search method=get accept-charset=utf-8 role=search><div class=input-group><input type=search name=q class=form-control placeholder=Search>
<input type=hidden name=sitesearch value=https://project.epicshit.io/>
<span class=input-group-btn><button type=submit class="btn btn-template-main"><i class="fas fa-search"></i></button></span></div></form></div></div><div class="panel panel-default sidebar-menu"><div class=panel-heading><h3 class=panel-title>Categories</h3></div><div class=panel-body><ul class="nav nav-pills nav-stacked"><li><a href=/categories/ansible>ANSIBLE (4)</a></li><li><a href=/categories/astra-control>ASTRA-CONTROL (2)</a></li><li><a href=/categories/astracontrol>ASTRACONTROL (5)</a></li><li><a href=/categories/automation>AUTOMATION (6)</a></li><li><a href=/categories/azure>AZURE (5)</a></li><li><a href=/categories/cloud>CLOUD (3)</a></li><li><a href=/categories/devops>DEVOPS (11)</a></li><li><a href=/categories/docker>DOCKER (7)</a></li><li><a href=/categories/gcp>GCP (5)</a></li><li><a href=/categories/hashicorp>HASHICORP (1)</a></li><li><a href=/categories/homematic>HOMEMATIC (2)</a></li><li><a href=/categories/jenkins>JENKINS (2)</a></li><li><a href=/categories/kubernetes>KUBERNETES (11)</a></li><li><a href=/categories/netapp>NETAPP (11)</a></li><li><a href=/categories/powershell>POWERSHELL (1)</a></li><li><a href=/categories/trident>TRIDENT (11)</a></li></ul></div></div><div class="panel sidebar-menu"><div class=panel-heading><h3 class=panel-title>Tags</h3></div><div class=panel-body><ul class=tag-cloud><li><a href=/tags/ansible><i class="fas fa-tags"></i> ansible</a></li><li><a href=/tags/automation><i class="fas fa-tags"></i> automation</a></li><li><a href=/tags/cloud><i class="fas fa-tags"></i> cloud</a></li><li><a href=/tags/hashicorp><i class="fas fa-tags"></i> hashicorp</a></li></ul></div></div></div></div></div></div><footer id=footer><div class=container><div class="col-md-4 col-sm-6"><h4>About us</h4><p>That's all my own thoughts.</p><hr class="hidden-md hidden-lg hidden-sm"></div><div class="col-md-4 col-sm-6"><h4>Recent posts</h4><div class=blog-entries><div class="item same-height-row clearfix"><div class="image same-height-always"><a href=https://project.epicshit.io/blog/2023/04/25/netapptridentintheedge/><img src=/na_devops.png class=img-responsive alt="NetApp Trident in the Edge"></a></div><div class="name same-height-always"><h5><a href=https://project.epicshit.io/blog/2023/04/25/netapptridentintheedge/>NetApp Trident in the Edge</a></h5></div></div><div class="item same-height-row clearfix"><div class="image same-height-always"><a href=https://project.epicshit.io/blog/2022/04/13/buildyourenv-monitoring/><img src=/byke_title_monitoring.png class=img-responsive alt="Monitoring of Kubernetes Cluster ..."></a></div><div class="name same-height-always"><h5><a href=https://project.epicshit.io/blog/2022/04/13/buildyourenv-monitoring/>Monitoring of Kubernetes Cluster ...</a></h5></div></div><div class="item same-height-row clearfix"><div class="image same-height-always"><a href=https://project.epicshit.io/blog/2022/04/03/buildyourenv-addbackup/><img src=/nadevops-autobackup.png class=img-responsive alt="Add Kubernetes Cluster to Astra Control"></a></div><div class="name same-height-always"><h5><a href=https://project.epicshit.io/blog/2022/04/03/buildyourenv-addbackup/>Add Kubernetes Cluster to Astra Control</a></h5></div></div></div><hr class="hidden-md hidden-lg"></div></div></footer><div id=copyright><div class=container><div class=col-md-12><p class=pull-left>Copyright (c) 2021, Fabian Born; all rights reserved.</p><p class=pull-right>Template by <a href=https://bootstrapious.com/p/universal-business-e-commerce-template>Bootstrapious</a>.
Ported to Hugo by <a href=https://github.com/devcows/hugo-universal-theme>DevCows</a>.</p></div></div></div></div><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-144284829-1','auto'),ga('send','pageview'))</script><script src=//code.jquery.com/jquery-3.1.1.min.js integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin=anonymous></script><script src=//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script><script src=//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/Counter-Up/1.0/jquery.counterup.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/jquery-parallax/1.1.3/jquery-parallax.js></script><script src=/js/front.js></script><script src=/js/owl.carousel.min.js></script></body></html>