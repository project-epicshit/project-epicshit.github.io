<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta name=viewport content="width=device-width,initial-scale=1"><title>FSxN &amp;amp; ROSA = ❤️</title><meta name=author content="Fabian Born"><meta name=keywords content="Fabian Born,hugo,go"><meta name=description content><meta name=generator content="Hugo 0.85.0"><link href="//fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,500,700,800" rel=stylesheet type=text/css><link rel=stylesheet href=//use.fontawesome.com/releases/v5.11.2/css/all.css><link rel=stylesheet href=//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link href=/css/animate.css rel=stylesheet><link href=/css/style.blue.css rel=stylesheet id=theme-stylesheet><link href=/css/custom.css rel=stylesheet><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel="shortcut icon" href=/img/favicon.ico type=image/x-icon><link rel=apple-touch-icon href=/img/apple-touch-icon.png><link href=/css/owl.carousel.css rel=stylesheet><link href=/css/owl.theme.css rel=stylesheet><link rel=alternate href=https://project.epicshit.io/index.xml type=application/rss+xml title="-:: Cloud is yours and all the new things ::-"><meta property="og:updated_time" content="2023-10-05T00:00:00+0200"><meta property="article:section" content="NetApp"><meta property="article:published_time" content="2023-10-05T00:00:00+0200"><meta property="article:modified_time" content="2023-10-05T00:00:00+0200"><meta name=twitter:card content="summary"><meta name=twitter:title content="FSxN &amp;amp; ROSA = ❤️"><meta name=twitter:description content></head><body><div id=all><header class=navbar-affixed-top data-spy=affix data-offset-top=62><div class="navbar navbar-default yamm" role=navigation id=navbar><div class=container><div class=navbar-header><a class="navbar-brand home" href=/><img src=/img/logo.png alt="FSxN & ROSA = ❤️ logo" class="hidden-xs hidden-sm">
<img src=/img/logo.png alt="FSxN & ROSA = ❤️ logo" class="visible-xs visible-sm">
<span class=sr-only>FSxN & ROSA = ❤️ - go to homepage</span></a><div class=navbar-buttons><button type=button class="navbar-toggle btn-template-main" data-toggle=collapse data-target=#navigation>
<span class=sr-only>Toggle Navigation</span>
<i class="fas fa-align-justify"></i></button></div></div><div class="navbar-collapse collapse" id=navigation><ul class="nav navbar-nav navbar-right"><li class=dropdown><a href=/>Home</a></li><li class="dropdown use-yamm yamm-fw"><a href=# class=dropdown-toggle data-toggle=dropdown role=button aria-haspopup=true aria-expanded=false>Blog <span class=caret></span></a><ul class=dropdown-menu><li><div class=yamm-content><div class=row><div class=col-sm-6><img src=/img/blogging.png class="img-responsive hidden-xs"></div><div class=col-sm-3><h5>Blog Posts</h5><ul><li><a href=/blog/>all Posts</a></li><li><a href=/categories/devops/>DevOps</a></li><li><a href=/categories/cloud/>Cloud</a></li><li><a href=/categories/netapp/>NetApp</a></li></ul></div><div class=col-sm-3></div></div></div></li></ul></li><li class="dropdown use-yamm yamm-fw"><a href=# class=dropdown-toggle data-toggle=dropdown role=button aria-haspopup=true aria-expanded=false>Community <span class=caret></span></a><ul class=dropdown-menu><li><div class=yamm-content><div class=row><div class=col-sm-6><img src=https://connectedindustry.net/wp-content/uploads/sites/18/2016/11/icon-community-300x234.png class="img-responsive hidden-xs"></div><div class=col-sm-3><h5>Enter Community</h5><ul><li><a href=https://auth.epicshit.io/if/flow/default-enrollment-flow/>Sign Up</a></li><li><a href=https://auth.epicshit.io>Login</a></li></ul></div><div class=col-sm-3></div></div></div></li></ul></li></ul></div><div class="collapse clearfix" id=search><form class=navbar-form role=search><div class=input-group><input type=text class=form-control placeholder=Search>
<span class=input-group-btn><button type=submit class="btn btn-template-main"><i class="fas fa-search"></i></button></span></div></form></div></div></div></header><div id=heading-breadcrumbs><div class=container><div class=row><div class=col-md-12><h1>FSxN & ROSA = ❤️</h1></div></div></div></div><div id=content><div class=container><div class=row><div class=col-md-9 id=blog-post><p class="text-muted text-uppercase mb-small text-right">October 5, 2023</p><div id=post-content><h1 id=fsx-for-netapp-ontap-and-redhat-openshift-on-aws-a-perfect-match>FSx for NetApp ONTAP and RedHat Openshift on AWS a perfect match</h1><h2 id=solution-overview>Solution Overview</h2><p>﻿ROSA is one of the latest services offered by RedHat on Amazon Web Services (AWS). This means that it is now possible to use the same products that are familiar from the DataCenter world in the public cloud, with the advantage that they are now available as a managed service. ROSA is enhanced with Amazon FSx for NetApp ONTAP (FSxN). By using FSxN, Openshift gets more stability and redundancy across Availability Zones in the cloud.</p><h4 id=architecture>Architecture</h4><p>﻿<img src=https://github.com/project-epicshit/project-epicshit.github.io/assets/36699674/6c80b9b6-c0c0-415a-9606-178ce4f9b743 alt=grafik></p><h3 id=why-rosa-with-fsxn>Why ROSA with FSxN</h3><p>The combination of RedHat and NetApp products provides an HA solution for running Kubernetes workloads across availability zones (AZs). From a container perspective, there is always the possibility of restarting on another node in another zone. With NetApp Storage for Persistent Data there is an HA solution which managed the failover.</p><p>NetApp Astra Trident is used to connect the storage to ROSA. As a CSI driver, Trident is responsible for provisioning the PVC on FSxN and mounting it directly into the container</p><h3 id=prerequisites>Prerequisites</h3><pre><code>- AWS credentials that provides the necessary permissions to create the resources (VPC, Compute, etc)
- AWS account has been linked with RedHat (see ROSA documentation)
</code></pre><h3 id=connectivity>Connectivity</h3><p>The most important part of this solution is that connectivity can be established between ROSA nodes and FSxN SVM. It is necessary to pay attention to VPC, subnet, routing table etc..
There are many ways to accomplish this, but for the sake of simplicity, in this guide everything is configured in the same VPC and subnets.</p><h2 id=steps-in-this-guide>Steps in this guide</h2><ol><li>Creating ROSA</li><li>Deploying FSx for NetApp ONTAP</li><li>Installing and configuring Trident</li></ol><h3 id=creating-a--rosa-cluster-with>Creating a ROSA Cluster with</h3><p>There minumum of three ways to deploy a ROSA cluster.
- On the CLI with the command &ldquo;rosa&rdquo;
- WebUI => <a href=https://console.redhat.com>https://console.redhat.com</a>
- Terraform</p><p>This guide will use the rosa CLI <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>rosa create cluster
</code></pre></div><p>following inputs are required - for the most questions I used the default settings!</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>I: Enabling interactive mode
? Cluster name: **democluster**
? Deploy cluster with Hosted Control Plane <span style=color:#f92672>(</span>optional<span style=color:#f92672>)</span>: **No**
? Create cluster admin user: **Yes**
? Username: **demoadmin**
? Password: <span style=color:#f92672>[</span>? <span style=color:#66d9ef>for</span> help<span style=color:#f92672>]</span> **************
? Deploy cluster using AWS STS: **Yes**
W: In a future release STS will be the default mode.
W: --sts flag will not be necessary <span style=color:#66d9ef>if</span> you wish to use STS.
W: --non-sts/--mint-mode flag will be necessary <span style=color:#66d9ef>if</span> you <span style=color:#66d9ef>do</span> not wish to use STS.
? OpenShift version: **4.12.35**
? Configure the use of IMDSv2 <span style=color:#66d9ef>for</span> ec2 instances optional/required <span style=color:#f92672>(</span>optional<span style=color:#f92672>)</span>: 
I: Using arn:aws:iam::XXXXXXXXXXXX:role/ManagedOpenShift-Installer-Role <span style=color:#66d9ef>for</span> the Installer role
I: Using arn:aws:iam::XXXXXXXXXXXX:role/ManagedOpenShift-ControlPlane-Role <span style=color:#66d9ef>for</span> the ControlPlane role
I: Using arn:aws:iam::XXXXXXXXXXXX:role/ManagedOpenShift-Worker-Role <span style=color:#66d9ef>for</span> the Worker role
I: Using arn:aws:iam::XXXXXXXXXXXX:role/ManagedOpenShift-Support-Role <span style=color:#66d9ef>for</span> the Support role
? External ID <span style=color:#f92672>(</span>optional<span style=color:#f92672>)</span>: 
? Operator roles prefix: **democluster-s4i6**
? Deploy cluster using pre registered OIDC Configuration ID: **No**
W: No OIDC Configuration found; will <span style=color:#66d9ef>continue</span> with the classic flow.
? Tags <span style=color:#f92672>(</span>optional<span style=color:#f92672>)</span>: 
? Multiple availability zones <span style=color:#f92672>(</span>optional<span style=color:#f92672>)</span>: **Yes**
? AWS region: **us-east-1**
? PrivateLink cluster <span style=color:#f92672>(</span>optional<span style=color:#f92672>)</span>: **No**
? Machine CIDR: **10.0.0.0/16**
? Service CIDR: **172.30.0.0/16**
? Pod CIDR: **10.128.0.0/14**
? Install into an existing VPC <span style=color:#f92672>(</span>optional<span style=color:#f92672>)</span>: **No**
? Select availability zones <span style=color:#f92672>(</span>optional<span style=color:#f92672>)</span>: **No**
? Enable Customer Managed key <span style=color:#f92672>(</span>optional<span style=color:#f92672>)</span>: **No**
? Compute nodes instance type: **m5.xlarge**
? Enable autoscaling <span style=color:#f92672>(</span>optional<span style=color:#f92672>)</span>: **No**
? Compute nodes: **3**
? Default machine pool labels <span style=color:#f92672>(</span>optional<span style=color:#f92672>)</span>: 
? Host prefix: **23**
? Enable FIPS support <span style=color:#f92672>(</span>optional<span style=color:#f92672>)</span>: **No**
? Encrypt etcd data <span style=color:#f92672>(</span>optional<span style=color:#f92672>)</span>: **No**
? Disable Workload monitoring <span style=color:#f92672>(</span>optional<span style=color:#f92672>)</span>: **Yes**

I: Creating cluster <span style=color:#e6db74>&#39;democluster&#39;</span>
</code></pre></div><p>After filling out all the questions you will get an overview what will be deployed now!</p><pre><code>I: To create this cluster again in the future, you can run:
   rosa create cluster ...
I: To view a list of clusters and their status, run 'rosa list clusters'
I: Cluster 'democluster' has been created.
I: Once the cluster is installed you will need to add an Identity Provider before you can login into the cluster. See 'rosa create idp --help' for more information.

Name:                       democluster
ID:                         26m2gh2eplvr1m7ffaaku4mlmtkr63v6
External ID:                
Control Plane:              Customer Hosted
OpenShift Version:          
Channel Group:              stable
DNS:                        Not ready
AWS Account:                XXXXXXXXXXX
API URL:                    
Console URL:                
Region:                     us-east-1
Multi-AZ:                   true
Nodes:
 - Control plane:           3
 - Infra:                   3
 - Compute:                 3
Network:
 - Type:                    OVNKubernetes
 - Service CIDR:            172.30.0.0/16
 - Machine CIDR:            10.0.0.0/16
 - Pod CIDR:                10.128.0.0/14
 - Host Prefix:             /23
STS Role ARN:               arn:aws:iam::XXXXXXXXXXX:role/ManagedOpenShift-Installer-Role
Support Role ARN:           arn:aws:iam::XXXXXXXXXXX:role/ManagedOpenShift-Support-Role
Instance IAM Roles:
 - Control plane:           arn:aws:iam::XXXXXXXXXXX:role/ManagedOpenShift-ControlPlane-Role
 - Worker:                  arn:aws:iam::XXXXXXXXXXX:role/ManagedOpenShift-Worker-Role
Operator IAM Roles:
 - arn:aws:iam::XXXXXXXXXXX:role/democluster-s4i6-openshift-machine-api-aws-cloud-credentials
 - arn:aws:iam::XXXXXXXXXXX:role/democluster-s4i6-openshift-cloud-credential-operator-cloud-crede
 - arn:aws:iam::XXXXXXXXXXX:role/democluster-s4i6-openshift-image-registry-installer-cloud-creden
 - arn:aws:iam::XXXXXXXXXXX:role/democluster-s4i6-openshift-ingress-operator-cloud-credentials
 - arn:aws:iam::XXXXXXXXXXX:role/democluster-s4i6-openshift-cluster-csi-drivers-ebs-cloud-credent
 - arn:aws:iam::XXXXXXXXXXX:role/democluster-s4i6-openshift-cloud-network-config-controller-cloud
Managed Policies:           No
State:                      waiting (Waiting for OIDC configuration)
Private:                    No
Created:                    Oct  5 2023 08:39:36 UTC
User Workload Monitoring:   disabled
Details Page:               https://console.redhat.com/openshift/details/s/2WKxfWyuNMhPGuwp0SqdW95Q5zk
OIDC Endpoint URL:          https://rh-oidc.s3.us-east-1.amazonaws.com/26m2gh2eplvr1m7ffaaku4mlmtkr63v6 (Classic)

I: 
Run the following commands to continue the cluster creation:

	rosa create operator-roles --cluster democluster
	rosa create oidc-provider --cluster democluster

I: To determine when your cluster is Ready, run 'rosa describe cluster -c democluster'.
I: To watch your cluster installation logs, run 'rosa logs install -c democluster --watch'.

</code></pre><p>For creating the operator-roles and the oidc-provider I used the &ldquo;auto&rdquo; creation mode!</p><p>﻿<img src=https://github.com/project-epicshit/project-epicshit.github.io/assets/36699674/9850ce16-6c30-45e5-bfcc-d4501ddbe18f alt=grafik></p><p>It takes a while for the cluster to be deployed. RedHat gives a time range of 30-60 minutes!</p><h2 id=creating-fsx>Creating FSx</h2><h3 id=links--footnotes>Links / Footnotes</h3><p><a href=https://docs.openshift.com/rosa/rosa_install_access_delete_clusters/rosa-sts-creating-a-cluster-quickly.html>ROSA - Creating Cluster Guide</a></p><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>ROSA CLI&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></div></div><div class=col-md-3><div class="panel panel-default sidebar-menu"><div class=panel-heading><h3 class=panel-title>Search</h3></div><div class=panel-body><form action=//google.com/search method=get accept-charset=utf-8 role=search><div class=input-group><input type=search name=q class=form-control placeholder=Search>
<input type=hidden name=sitesearch value=https://project.epicshit.io/>
<span class=input-group-btn><button type=submit class="btn btn-template-main"><i class="fas fa-search"></i></button></span></div></form></div></div><div class="panel panel-default sidebar-menu"><div class=panel-heading><h3 class=panel-title>Categories</h3></div><div class=panel-body><ul class="nav nav-pills nav-stacked"><li><a href=/categories/ansible>ANSIBLE (4)</a></li><li><a href=/categories/astra-control>ASTRA-CONTROL (2)</a></li><li><a href=/categories/astracontrol>ASTRACONTROL (6)</a></li><li><a href=/categories/automation>AUTOMATION (6)</a></li><li><a href=/categories/aws>AWS (1)</a></li><li><a href=/categories/azure>AZURE (5)</a></li><li><a href=/categories/cloud>CLOUD (3)</a></li><li><a href=/categories/devops>DEVOPS (12)</a></li><li><a href=/categories/docker>DOCKER (8)</a></li><li><a href=/categories/gcp>GCP (5)</a></li><li><a href=/categories/hashicorp>HASHICORP (1)</a></li><li><a href=/categories/homematic>HOMEMATIC (2)</a></li><li><a href=/categories/jenkins>JENKINS (2)</a></li><li><a href=/categories/kubernetes>KUBERNETES (12)</a></li><li><a href=/categories/netapp>NETAPP (12)</a></li><li><a href=/categories/openshift>OPENSHIFT (1)</a></li><li><a href=/categories/powershell>POWERSHELL (1)</a></li><li><a href=/categories/redhat>REDHAT (1)</a></li><li><a href=/categories/trident>TRIDENT (12)</a></li></ul></div></div><div class="panel sidebar-menu"><div class=panel-heading><h3 class=panel-title>Tags</h3></div><div class=panel-body><ul class=tag-cloud><li><a href=/tags/ansible><i class="fas fa-tags"></i> ansible</a></li><li><a href=/tags/automation><i class="fas fa-tags"></i> automation</a></li><li><a href=/tags/cloud><i class="fas fa-tags"></i> cloud</a></li><li><a href=/tags/hashicorp><i class="fas fa-tags"></i> hashicorp</a></li></ul></div></div></div></div></div></div><footer id=footer><div class=container><div class="col-md-4 col-sm-6"><h4>About us</h4><p>That's all my own thoughts.</p><hr class="hidden-md hidden-lg hidden-sm"></div><div class="col-md-4 col-sm-6"><h4>Recent posts</h4><div class=blog-entries><div class="item same-height-row clearfix"><div class="image same-height-always"><a href=https://project.epicshit.io/blog/2023/10/05/fsxnwithrosa/><img src=https://github.com/project-epicshit/project-epicshit.github.io/assets/36699674/6c80b9b6-c0c0-415a-9606-178ce4f9b743 class=img-responsive alt="FSxN & ROSA = ❤️"></a></div><div class="name same-height-always"><h5><a href=https://project.epicshit.io/blog/2023/10/05/fsxnwithrosa/>FSxN & ROSA = ❤️</a></h5></div></div><div class="item same-height-row clearfix"><div class="image same-height-always"><a href=https://project.epicshit.io/blog/2023/05/02/netapptridentintheedge/><img src=/trident-in-the-edge.png class=img-responsive alt="NetApp Trident in the Edge"></a></div><div class="name same-height-always"><h5><a href=https://project.epicshit.io/blog/2023/05/02/netapptridentintheedge/>NetApp Trident in the Edge</a></h5></div></div><div class="item same-height-row clearfix"><div class="image same-height-always"><a href=https://project.epicshit.io/blog/2022/04/13/buildyourenv-monitoring/><img src=/byke_title_monitoring.png class=img-responsive alt="Monitoring of Kubernetes Cluster ..."></a></div><div class="name same-height-always"><h5><a href=https://project.epicshit.io/blog/2022/04/13/buildyourenv-monitoring/>Monitoring of Kubernetes Cluster ...</a></h5></div></div></div><hr class="hidden-md hidden-lg"></div></div></footer><div id=copyright><div class=container><div class=col-md-12><p class=pull-left>Copyright (c) 2021, Fabian Born; all rights reserved.</p><p class=pull-right>Template by <a href=https://bootstrapious.com/p/universal-business-e-commerce-template>Bootstrapious</a>.
Ported to Hugo by <a href=https://github.com/devcows/hugo-universal-theme>DevCows</a>.</p></div></div></div></div><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-144284829-1','auto'),ga('send','pageview'))</script><script src=//code.jquery.com/jquery-3.1.1.min.js integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin=anonymous></script><script src=//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script><script src=//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/Counter-Up/1.0/jquery.counterup.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/jquery-parallax/1.1.3/jquery-parallax.js></script><script src=/js/front.js></script><script src=/js/owl.carousel.min.js></script></body></html>