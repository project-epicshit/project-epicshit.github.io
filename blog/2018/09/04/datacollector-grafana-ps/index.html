<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta name=viewport content="width=device-width,initial-scale=1"><title>UPDATE: Datacollector für HomeMatic und Grafana mit PoSH</title><meta name=author content><meta name=keywords content="Fabian Born,hugo,go"><meta name=generator content="Hugo 0.85.0"><link href="//fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,500,700,800" rel=stylesheet type=text/css><link rel=stylesheet href=//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet href=//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link href=/css/animate.css rel=stylesheet><link href=/css/style.blue.css rel=stylesheet id=theme-stylesheet><link href=/css/custom.css rel=stylesheet><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel="shortcut icon" href=/img/favicon.ico type=image/x-icon><link rel=apple-touch-icon href=/img/apple-touch-icon.png><link href=/css/owl.carousel.css rel=stylesheet><link href=/css/owl.theme.css rel=stylesheet><link rel=alternate href=https://hungry-carson-5114f7.netlify.app/index.xml type=application/rss+xml title="-:: Cloud is yours and all the new things ::-"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@NTAPFabian"><meta name=twitter:title content="UPDATE: Datacollector für HomeMatic und Grafana mit PoSH"><meta name=twitter:image content="https://hungry-carson-5114f7.netlify.app/img/grafana-overview.png"><meta name=twitter:description content><meta property="og:title" content="UPDATE: Datacollector für HomeMatic und Grafana mit PoSH"><meta property="og:type" content="website"><meta property="og:url" content="https://hungry-carson-5114f7.netlify.app/blog/2018/09/04/datacollector-grafana-ps//"><meta property="og:image" content="img/logo.png"></head><body><div id=all><header><div class=navbar-affixed-top data-spy=affix data-offset-top=200><div class="navbar navbar-default yamm" role=navigation id=navbar><div class=container><div class=navbar-header><a class="navbar-brand home" href=https://hungry-carson-5114f7.netlify.app><img src=https://hungry-carson-5114f7.netlify.appimg/logo.png alt="UPDATE: Datacollector für HomeMatic und Grafana mit PoSH logo" class="hidden-xs hidden-sm">
<img src=https://hungry-carson-5114f7.netlify.appimg/logo.png alt="UPDATE: Datacollector für HomeMatic und Grafana mit PoSH logo" class="visible-xs visible-sm">
<span class=sr-only>UPDATE: Datacollector für HomeMatic und Grafana mit PoSH - go to homepage</span></a><div class=navbar-buttons><button type=button class="navbar-toggle btn-template-main" data-toggle=collapse data-target=#navigation>
<span class=sr-only>Toggle Navigation</span>
<i class="fa fa-align-justify"></i></button></div></div><div class="navbar-collapse collapse" id=navigation><ul class="nav navbar-nav navbar-right"><li class=dropdown><a href=/>Home</a></li><li class="dropdown active"><a href=/blog/>Blog</a></li></ul></div><div class="collapse clearfix" id=search><form class=navbar-form role=search><div class=input-group><input type=text class=form-control placeholder=Search>
<span class=input-group-btn><button type=submit class="btn btn-template-main"><i class="fa fa-search"></i></button></span></div></form></div></div></div></div></header><div id=heading-breadcrumbs><div class=container><div class=row><div class=col-md-12><h1>UPDATE: Datacollector für HomeMatic und Grafana mit PoSH</h1></div></div></div></div><div id=content><div class=container><div class=row><div class=col-md-9 id=blog-post><p class="text-muted text-uppercase mb-small text-right">September 4, 2018</p><div id=post-content><p><img src=/img/grafana-overview.png alt="Grafana Screenshot"></p><h2 id=update-jetzt-mit-powershell>Update: Jetzt mit Powershell</h2><p>Nach dem das Powershell Skript eine weile lief, habe ich mich daran gemacht, es einwenig umzubauen. Anforderung war, dass es in bestimmten Abständen laufen soll, aber man hierfür nicht die Cron von Linux nehmen muss. Ich habe mich dann Entschieden Powershell 6 Core zu verweden.</p><h2 id=wie-bekomme-ich-die-daten-aus-der-ccu>Wie bekomme ich die Daten aus der CCU?</h2><p>Die Daten werden aus den verschiedenen URLS</p><ul><li>http://ip/config/xmlapi/roomlist.cgi</li></ul><ul><li>Auflistung der Rooms</li></ul><ul><li>http://ip/config/xmlapi/state.cgi</li></ul><ul><li>aktueller State aller angelernter Geräte</li><li>Sortierbar nach z.B. channel_id oder device_id</li></ul><p>in ein XML Array geladen und dann verarbeitet.</p><p>Sobald man die gewünschten Daten zur Verfügung hat, muss man sie an Grafana/Graphite schicken. Hierzu möchte ich nun meine Powershell Funktion zur Verfügung stellen:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-posh data-lang=posh><span style=color:#66d9ef>function</span> Send-ToGraphite {
    <span style=color:#66d9ef>param</span>(
        <span style=color:#66d9ef>[string]</span>$carbonServer,
        <span style=color:#66d9ef>[string]</span>$carbonServerPort,
        <span style=color:#66d9ef>[string[]]</span>$metrics
    )
      <span style=color:#66d9ef>try</span>
        {
        $socket = New-Object System.Net.Sockets.TCPClient
        $socket.connect($carbonServer, $carbonServerPort)
        $stream = $socket.GetStream() 
        $writer = new-object System.IO.StreamWriter($stream)
        <span style=color:#66d9ef>foreach</span> ($metric <span style=color:#66d9ef>in</span> $metrics){
          <span style=color:#75715e>#  Write-Host $metric</span>
            $newMetric = $metric.TrimEnd()
           $writer.WriteLine($newMetric)
            }
        $writer.Flush()
        $writer.Close()
        $stream.Close()
        }
        <span style=color:#66d9ef>catch</span>
        {   
            Write-Error $_
        }
}
</code></pre></div><p>Der Aufruf im Skript ist:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-posh data-lang=posh>    $ Send-ToGraphite -carbonServer $carbonServer -carbonServerPort $carbonServerPort -metric <span style=color:#e6db74>&#34;</span>$($base)<span style=color:#e6db74>.</span>$($roomname)<span style=color:#e6db74>.</span>$($devicename)<span style=color:#e6db74>.</span>$($datapoint_name)<span style=color:#e6db74> </span>$($datapoint_value)<span style=color:#e6db74> </span>$($date)<span style=color:#e6db74>&#34;</span>
</code></pre></div><p>Für aktuellere Informationen zum Konfigurieren und ausführen des Datacollector findet man auf der gitlab-Projekt Seite: [hm2grafana-posh]( <a href=https://github.com/fabian-born/hm2grafana-posh>https://github.com/fabian-born/hm2grafana-posh</a> &ldquo;hm2grafana-posh on github)</p></div></div><div class=col-md-3><div class="panel panel-default sidebar-menu"><div class=panel-heading><h3 class=panel-title>Search</h3></div><div class=panel-body><form action=//google.com/search method=get accept-charset=utf-8 role=search><div class=input-group><input type=search name=q class=form-control placeholder=Search>
<input type=hidden name=sitesearch value=https://hungry-carson-5114f7.netlify.app>
<span class=input-group-btn><button type=submit class="btn btn-template-main"><i class="fa fa-search"></i></button></span></div></form></div></div><div class="panel panel-default sidebar-menu"><div class=panel-heading><h3 class=panel-title>Categories</h3></div><div class=panel-body><ul class="nav nav-pills nav-stacked"><li><a href=https://hungry-carson-5114f7.netlify.appcategories/ansible>ansible (4)</a></li><li><a href=https://hungry-carson-5114f7.netlify.appcategories/automation>automation (6)</a></li><li><a href=https://hungry-carson-5114f7.netlify.appcategories/cloud>cloud (3)</a></li><li><a href=https://hungry-carson-5114f7.netlify.appcategories/devops>devops (4)</a></li><li><a href=https://hungry-carson-5114f7.netlify.appcategories/docker>docker (2)</a></li><li><a href=https://hungry-carson-5114f7.netlify.appcategories/hashicorp>hashicorp (1)</a></li><li><a href=https://hungry-carson-5114f7.netlify.appcategories/homematic>homematic (2)</a></li><li><a href=https://hungry-carson-5114f7.netlify.appcategories/jenkins>jenkins (2)</a></li><li><a href=https://hungry-carson-5114f7.netlify.appcategories/kubernetes>kubernetes (4)</a></li><li><a href=https://hungry-carson-5114f7.netlify.appcategories/netapp>netapp (4)</a></li><li><a href=https://hungry-carson-5114f7.netlify.appcategories/powershell>powershell (1)</a></li><li><a href=https://hungry-carson-5114f7.netlify.appcategories/trident>trident (4)</a></li></ul></div></div><div class="panel sidebar-menu"><div class=panel-heading><h3 class=panel-title>Tags</h3></div><div class=panel-body><ul class=tag-cloud><li><a href=https://hungry-carson-5114f7.netlify.apptags/ansible><i class="fa fa-tags"></i> ansible</a></li><li><a href=https://hungry-carson-5114f7.netlify.apptags/automation><i class="fa fa-tags"></i> automation</a></li><li><a href=https://hungry-carson-5114f7.netlify.apptags/cloud><i class="fa fa-tags"></i> cloud</a></li><li><a href=https://hungry-carson-5114f7.netlify.apptags/hashicorp><i class="fa fa-tags"></i> hashicorp</a></li></ul></div></div></div></div></div></div><footer id=footer><div class=container><div class="col-md-4 col-sm-6"><h4>About us</h4><hr class="hidden-md hidden-lg hidden-sm"></div><div class="col-md-4 col-sm-6"><h4>Recent posts</h4><div class=blog-entries><div class="item same-height-row clearfix"><div class="image same-height-always"><a href=https://hungry-carson-5114f7.netlify.app/blog/2021/01/22/tridentautomatedinstall_update/><img src=https://hungry-carson-5114f7.netlify.app/img/ka.png class=img-responsive alt="Installer Addon for NetApp Trident using kubectl - Update"></a></div><div class="name same-height-always"><h5><a href=https://hungry-carson-5114f7.netlify.app/blog/2021/01/22/tridentautomatedinstall_update/>Installer Addon for NetApp Trident using kubectl - Update</a></h5></div></div><div class="item same-height-row clearfix"><div class="image same-height-always"><a href=https://hungry-carson-5114f7.netlify.app/blog/2020/09/10/tridentautomatedinstall/><img src=https://hungry-carson-5114f7.netlify.app/img/ka.png class=img-responsive alt="Automated install of NetApp Trident using kubectl"></a></div><div class="name same-height-always"><h5><a href=https://hungry-carson-5114f7.netlify.app/blog/2020/09/10/tridentautomatedinstall/>Automated install of NetApp Trident using kubectl</a></h5></div></div><div class="item same-height-row clearfix"><div class="image same-height-always"><a href=https://hungry-carson-5114f7.netlify.app/blog/2020/05/08/netapp-ansible-with-hcav/><img src=https://hungry-carson-5114f7.netlify.appimg/netapp-ansible-hasicorp.png class=img-responsive alt="NetApp Ansible Authentication with Hashicorp Vault"></a></div><div class="name same-height-always"><h5><a href=https://hungry-carson-5114f7.netlify.app/blog/2020/05/08/netapp-ansible-with-hcav/>NetApp Ansible Authentication with Hashicorp Vault</a></h5></div></div></div><hr class="hidden-md hidden-lg"></div></div></footer><div id=copyright><div class=container><div class=col-md-12><p class=pull-left>Copyright (c) 2019, Fabian Born; all rights reserved.</p><p class=pull-right>Template by <a href=http://bootstrapious.com/free-templates>Bootstrapious</a>.</p></div></div></div></div><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-144284829-1','auto'),ga('send','pageview'))</script><script src=//code.jquery.com/jquery-3.1.1.min.js integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin=anonymous></script><script src=//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script><script src=//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/Counter-Up/1.0/jquery.counterup.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/jquery-parallax/1.1.3/jquery-parallax.js></script><script src="//maps.googleapis.com/maps/api/js?v=3.exp"></script><script src=https://hungry-carson-5114f7.netlify.appjs/hpneo.gmaps.js></script><script src=https://hungry-carson-5114f7.netlify.appjs/gmaps.init.js></script><script src=https://hungry-carson-5114f7.netlify.appjs/front.js></script><script src=https://hungry-carson-5114f7.netlify.appjs/owl.carousel.min.js></script></body></html>